command:
  check-app-version:
    exec: fluentd --version | grep -o "[0-9]*\.[0-9]*\.[0-9]"
    exit-status: 0
    stdout:
      - {{ .Env.APP_VERSION }}
  check-valid-config:
    exec: fluentd -c /opt/bitnami/fluentd/conf/fluentd.conf --dry-run
    exit-status: 0
  check-pem-files:
    exec: find /opt/bitnami/fluentd -name "*.pem"
    exit-status: 0
  check-fluent-plugin-detect-exceptions:
    exec: (ls -l /opt/bitnami/fluentd/gems/fluent-plugin-detect-exceptions-*/lib/fluent/plugin/exception_detector.rb 2>/dev/null | grep ".*-rwxrwxr-x") && (ls -l /opt/bitnami/fluentd/gems/fluent-plugin-detect-exceptions-*/lib/fluent/plugin/out_detect_exceptions.rb 2>/dev/null | grep ".*-rwxrwxr-x")
    exit-status: 0
  check-plugins:
    exec: ls /opt/bitnami/fluentd/gems/fluent-plugin-concat-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-detect-exceptions-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-elasticsearch-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-grafana-loki-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-kafka-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-kubernetes_metadata_filter-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-multi-format-parser-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-prometheus-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-rewrite-tag-filter-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-s3-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-systemd-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluent-plugin-record-modifier-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/oj-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/json-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/fluentd-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/activesupport-* 2>/dev/null && ls /opt/bitnami/fluentd/gems/elasticsearch-xpack-* 2>/dev/null
    exit-status: 0