########################
# Checks files exist,
# optionally checking their permissions
# Needed vars:
#   - .Vars.files (Array)
#   - .Vars.files.paths (Array)
# Optional vars:
#   - .Vars.files.mode (String)
#   - .Vars.files.owner (String)
#   - .Vars.files.group (String)
########################
file:
  {{ range .Vars.files }}
  {{ $attributes := dict }}
  {{ if and (index . "mode") }}
  {{ $_ := set $attributes "mode" .mode }}
  {{ end }}
  {{ if and (index . "owner") }}
  {{ $_ := set $attributes "owner" .owner }}
  {{ end }}
  {{ if and (index . "group") }}
  {{ $_ := set $attributes "group" .group }}
  {{ end }}
  {{ range $file := .paths }}
  {{ $file }}:
    exists: true
    filetype: file
    {{ range $att_name := list "mode" "owner" "group" }}
    {{ if hasKey $attributes $att_name }}
    "{{ $att_name }}": "{{ get $attributes $att_name }}"
    {{ end }}
    {{ end }}
  {{ end }}
  {{ end }}
